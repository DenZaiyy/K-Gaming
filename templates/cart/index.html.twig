{% extends 'base.html.twig' %}

{% block title %}Mon panier{% endblock %}

{% block body %}
	{% if cart|length > 0 %}
		{{ dump(cart) }}
		<div class="cart d-flex flex-wrap justify-content-center text-start gap-5 my-5">
			<div class="cart-item">
				<h2>Panier</h2>
				<div class="card d-flex gap-1 p-4">
					{% for item in cart %}
						<div class="game d-flex flex-wrap justify-content-between gap-2" id="gameCart"
						     data-id="{{ loop.index0 }}">
							<div class="about d-flex flex-wrap gap-3">
								<div class="image">
									<img src="https://images.igdb.com/igdb/image/upload/t_cover_med/{{ render(controller('App\\Controller\\GameController::getImageIDGame', { gameLabel: item.game.label })) }}.jpg"
									     draggable="false" alt="cover for game: {{ item.game.label }}">
								</div>
								<div class="infos d-flex flex-column justify-content-center">
									<div class="game-platform d-flex gap-2">
										<div class="platform-logo">
											<img src="{{ item.platform.logo }}"
											     draggable="false"
											     alt="plateforme {{ item.platform.label }}"
											     height="32" width="32">
										</div>
										<div class="game-name">
											<a href="{{ path('app_show_game_platform', {platformID: item.platform.id, gameID: item.game.id}) }}"><span>{{ item.game.label }}</span></a>
										</div>
									</div>
									<div class="delete-icon">
										<a href="{{ path('app_remove_cart', {'id': item.game.id, 'idPlatform': item.platform.id}) }}">
											<i class="bi bi-trash3-fill"></i> Retirer
										</a>
									</div>
								</div>
							</div>
							
							<div class="price d-flex align-items-center gap-2">
								{% set amount = null %}
								{% for stock in item.game.stocks %}
									{% if stock.isavailable == true and stock.plateform.id == item.platform.id and stock.purchase == null %}
										{% set amount = amount + 1 %}
									{% endif %}
								{% endfor %}
								
								<select name="qtt" class="form-select qtt"
								        data-game="{{ item.game.id }}"
								        data-platform="{{ item.platform.id }}">
									{% for i in range(1, amount) %}
										{% if i == item.quantity %}
											<option value="{{ i }}" selected>{{ i }}</option>
										{% else %}
											{% if loop.index <= 5 %}
												<option value="{{ i }}">{{ i }}</option>
											{% endif %}
										{% endif %}
									{% endfor %}
								</select>
								
								<strong>{{ item.game.price|price }}</strong>
							</div>
						</div>
						{% if not loop.last %}
							<hr>
						{% endif %}
					{% endfor %}
				</div>
			</div>
			
			<div class="summary w-25">
				<h2>Récapitulatif</h2>
				<div class="card p-4 d-flex gap-1">
					<div class="details mb-2">
						<strong class="d-flex flex-wrap justify-content-between align-items-center">
							Sous-total <span class="fs-5">{{ cartTotal|price }}</span>
						</strong>
					</div>
					<div class="btns w-100">
						<a href="{{ path('order_index') }}" class="btn btn-outline-primary w-100">Passer la commande</a>
						<hr>
						<a href="{{ path('app_home') }}" class="btn btn-outline-secondary w-100">Continuer mes
							achats</a>
					</div>
				</div>
			</div>
		</div>
	{% else %}
		<div class="container d-flex flex-column justify-content-center align-items-center my-5">
			<h1>Votre panier est vide</h1>
			<a href="{{ path('app_home') }}" class="btn btn-primary">Retour à l'accueil</a>
		</div>
	{% endif %}
{% endblock %}
